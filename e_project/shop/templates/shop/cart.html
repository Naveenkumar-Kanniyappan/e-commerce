{% extends 'shop/layouts/main.html' %}
{% load static %}
{% load cart_extras %}

{% block title %}
<title>Shopping Cart | e-Shop</title>
{% endblock title %}

{% block contend %}
<div class="container py-5" style="margin-top:70px;">
  <h2 class="mb-4 fw-bold text-center text-primary">
    <i class="fa-solid fa-cart-shopping me-2"></i>Your Shopping Cart
  </h2>

  {% if cart_items %}
  <div class="table-responsive shadow-sm rounded bg-white p-3">
    <table class="table align-middle table-hover">
      <thead class="table-dark">
        <tr>
          <th>Product</th>
          <th>Name</th>
          <th>Price</th>
          <th>Quantity</th>
          <th>Subtotal</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody>
        {% for item in cart_items %}
        <tr>
          <td>
            <img src="{{ item.product.product_image.url }}" alt="{{ item.product.name }}" width="80" class="rounded shadow-sm">
          </td>
          <td class="fw-semibold">{{ item.product.name }}</td>
          <td>₹{{ item.product.selling_price|stringformat:"d" }}</td>
          <td>
            <form method="POST" action="{% url 'update_cart' item.product.id %}" class="d-flex align-items-center gap-2">
              {% csrf_token %}
              <input 
                type="number" 
                name="quantity" 
                value="{{ item.quantity }}" 
                min="1" 
                class="form-control text-center" 
                style="width:80px;"
              >
              <button type="submit" class="btn btn-sm btn-outline-primary">
                <i class="fa-solid fa-rotate"></i>
              </button>
            </form>
          </td>
          <td class="fw-bold text-success">₹{{ item.subtotal|stringformat:"d" }}</td>
          <td>
            <a href="{% url 'remove_from_cart' item.product.id %}" class="btn btn-sm btn-outline-danger">
              <i class="fa-solid fa-trash"></i>
            </a>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>

    <div class="border-top pt-3 d-flex flex-column flex-md-row justify-content-between align-items-center">
      <h4 class="fw-bold text-dark mb-3 mb-md-0">Total: <span class="text-success">₹{{ total|stringformat:"d" }}</span></h4>
      <div class="d-flex gap-3">
        <a href="{% url 'collections' %}" class="btn btn-outline-secondary">
          <i class="fa-solid fa-arrow-left me-2"></i>Continue Shopping
        </a>
        <a href="{% url 'checkout' %}" class="btn btn-success">
          <i class="fa-solid fa-bag-shopping me-2"></i>Proceed to Checkout
        </a>
      </div>
    </div>
  </div>

  {% else %}
  <div class="text-center py-5 bg-light rounded shadow-sm">
    <i class="fa-solid fa-cart-arrow-down fa-3x text-muted mb-3"></i>
    <h4 class="text-muted">Your cart is empty.</h4>
    <a href="{% url 'collections' %}" class="btn btn-primary mt-3">
      <i class="fa-solid fa-shop me-2"></i>Start Shopping
    </a>
  </div>
  {% endif %}
</div>
{% endblock contend %}
